{% extends "base.html" %}
{% load static %}

{% block title %}{{ post.post_title }} | DORO LMS{% endblock %}

{% block content %}
<section class="hero">
  <div class="hero-inner">
    <h1 class="hero-title">ììœ ê²Œì‹œíŒ</h1>
  </div>
</section>

<main class="card-wrap">
  <div class="card-inner">

    <article style="max-width: 900px; margin: 0 auto;">

      <header style="border-bottom: 2px solid #dee2e6; padding-bottom: 20px; margin-bottom: 20px;">
        <h2 style="margin: 10px 0; font-size: 24px; font-weight: 600;">
          {% if not post.open %}
            <span style="color: #dc3545; font-size: 0.8em; vertical-align: middle;">ğŸ”’</span>
          {% endif %}
          {{ post.post_title }}
        </h2>

        <div style="display: flex; gap: 20px; color: #6c757d; font-size: 14px; margin-top: 15px;">
          <span>ğŸ‘¤ {{ post.author.name }}</span>
          <span>ğŸ“… {{ post.created_at|date:"Yë…„ mì›” dì¼ H:i" }}</span>
          <span>ğŸ‘ï¸ ì¡°íšŒìˆ˜ {{ post.view }}</span>
        </div>
      </header>

      <div style="line-height: 1.8; padding: 30px 0; min-height: 200px; white-space: pre-wrap;">
        {{ post.content }}
      </div>

      <div style="border-bottom: 1px solid #dee2e6; padding-bottom: 20px; margin-bottom: 40px; display: flex; justify-content: space-between; align-items: center;">
        <a href="{% url 'board:community_list' %}" style="display: inline-block; padding: 8px 16px; background-color: #6c757d; color: white; text-decoration: none; border-radius: 5px; font-size: 14px;">
          â† ëª©ë¡ìœ¼ë¡œ
        </a>

        <div style="display: flex; gap: 8px;">
          {% if request.user == post.author %}
          <a href="{% url 'board:community_update' post.post_id %}" style="display: inline-block; padding: 8px 16px; background-color: #0d6efd; color: white; text-decoration: none; border-radius: 5px; font-size: 14px;">
            âœï¸ ìˆ˜ì •
          </a>
          {% endif %}

          {% if request.user == post.author or request.user.is_manager %}
          <a href="{% url 'board:community_delete' post.post_id %}" style="display: inline-block; padding: 8px 16px; background-color: #dc3545; color: white; text-decoration: none; border-radius: 5px; font-size: 14px;">
            ğŸ—‘ï¸ ì‚­ì œ
          </a>
          {% endif %}
        </div>
      </div>

      <section class="comment-section" style="margin-top: 40px;">
        <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 15px;">
          ëŒ“ê¸€ <span style="color: #0d6efd;">{{ post.communitycomment_set.count }}</span>
        </h3>

        <ul style="list-style: none; padding: 0; margin-bottom: 30px;">
          {% for comment in post.communitycomment_set.all %}
          <li style="border-bottom: 1px solid #f1f3f5; padding: 15px 0;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
              <strong style="font-size: 14px; color: #212529;">{{ comment.author.name }}</strong>
              <span style="font-size: 12px; color: #868e96;">{{ comment.created_at|date:"Y-m-d H:i" }}</span>
            </div>
            <div style="white-space: pre-wrap; color: #495057; font-size: 14px;">{{ comment.comment_content }}</div>
          </li>
          {% empty %}
          <li style="padding: 20px 0; text-align: center; color: #868e96;">ì‘ì„±ëœ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤. ì²« ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”!</li>
          {% endfor %}
        </ul>

        {% if request.user.is_authenticated %}
        <form action="{% url 'board:comment_create' post.post_id %}" method="post" style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
          {% csrf_token %}
          <div style="display: flex; gap: 10px;">
            <textarea name="comment_content" required placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”." style="flex: 1; height: 60px; padding: 10px; border: 1px solid #dee2e6; border-radius: 5px; resize: none;"></textarea>
            <button type="submit" style="width: 80px; background-color: #495057; color: white; border: none; border-radius: 5px; cursor: pointer;">ë“±ë¡</button>
          </div>
        </form>
        {% else %}
        <div style="background: #f8f9fa; padding: 20px; text-align: center; border-radius: 8px; color: #868e96;">
          ëŒ“ê¸€ì„ ì‘ì„±í•˜ë ¤ë©´ <a href="{% url 'user:login' %}" style="color: #0d6efd; text-decoration: underline;">ë¡œê·¸ì¸</a>ì´ í•„ìš”í•©ë‹ˆë‹¤.
        </div>
        {% endif %}
      </section>

    </article>

  </div>
</main>
{% endblock %}